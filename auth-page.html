<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Daftar - Piilancer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Pacifico (for logo) and Montserrat (for headings) -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom font for a modern look */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom blue color for Tailwind */
        .bg-custom-blue {
            background-color: #8aceff;
        }
        .text-custom-blue {
            color: #8aceff;
        }
        .hover\\:bg-custom-blue-light:hover {
            background-color: #e0f2ff; /* A lighter shade for hover effects */
        }
        .hover\\:text-custom-blue-dark:hover {
            color: #007bff; /* A slightly darker blue for hover text */
        }
        .focus\\:ring-custom-blue-focus:focus {
            --tw-ring-color: #8aceff;
        }
        /* Style for Piilancer logo font */
        .piilancer-logo {
            font-family: 'Pacifico', cursive;
            font-size: 2rem;
            line-height: 1;
        }
        /* Style for Hero Section Heading font */
        .hero-heading-font {
            font-family: 'Montserrat', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">
    <div class="min-h-screen flex flex-col">
        <!-- Header Section (Consistent with other pages) -->
        <header class="bg-white shadow-md py-4">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <a href="homepage-template.html" class="piilancer-logo text-blue-600 rounded-lg p-2 hover:bg-blue-50 transition duration-300">Piilancer</a>
                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="baca-blog-page.html" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300 rounded-lg px-3 py-2 hover:bg-gray-100">Baca Blog</a>
                    <a href="tulis-blog-page.html" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300 rounded-lg px-3 py-2 hover:bg-gray-100">Tulis Blog</a>
                    <a href="kedai-pelajar-page.html" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300 rounded-lg px-3 py-2 hover:bg-gray-100">Kedai Pelajar</a>
                    <a href="tentang-page.html" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300 rounded-lg px-3 py-2 hover:bg-gray-100">Tentang</a>
                    
                    <!-- Profile Picture / Auth Menu -->
                    <div class="relative ml-4">
                        <button id="profile-menu-button" class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-200 text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300">
                            <img id="profile-pic" src="https://placehold.co/40x40/cbd5e1/4a5568?text=U" alt="User Profile" class="rounded-full w-full h-full object-cover hidden">
                            <svg id="profile-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M12 4a4 4 0 100 8 4 4 0 000-8zm-2 9a4 4 0 00-4 4v1a2 2 0 002 2h8a2 2 0 002-2v-1a4 4 0 00-4-4h-4z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="profile-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden">
                            <a href="auth-page.html" id="login-signup-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Login / Daftar</a>
                            <a href="#" id="my-profile-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hidden">Profil Saya</a>
                            <button id="logout-button" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 hidden">Logout</button>
                        </div>
                    </div>
                </nav>
                <!-- Mobile Menu Button (Hamburger) -->
                <button class="md:hidden text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content - Auth Forms -->
        <main class="flex-grow py-16 bg-gray-100 flex items-center justify-center">
            <div class="container mx-auto px-4 max-w-md bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-8 text-gray-900 hero-heading-font">Masuk atau Daftar</h1>

                <!-- Firebase Status Message Area -->
                <div id="firebase-status" class="mb-4 p-3 rounded-lg text-sm text-center bg-blue-50 text-blue-800 border border-blue-200 hidden">
                    <!-- Status will be displayed here by JavaScript -->
                </div>

                <!-- Message Display Area -->
                <div id="message-area" class="mb-6"></div>

                <!-- Tab Buttons for Login/Signup -->
                <div class="flex justify-center mb-6">
                    <button id="login-tab" class="px-6 py-3 rounded-l-lg font-semibold text-lg transition duration-300"
                            style="background-color: #3b82f6; color: white;">Masuk</button>
                    <button id="signup-tab" class="px-6 py-3 rounded-r-lg font-semibold text-lg transition duration-300"
                            style="background-color: #e0f2fe; color: #3b82f6;">Daftar</button>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-email" class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="login-email" name="login-email" placeholder="Masukkan email Anda" required
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-gray-800">
                    </div>
                    <div>
                        <label for="login-password" class="block text-lg font-medium text-gray-700 mb-2">Kata Sandi</label>
                        <input type="password" id="login-password" name="login-password" placeholder="Masukkan kata sandi Anda" required
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-gray-800">
                    </div>
                    <div class="text-center">
                        <button type="submit" id="login-button" class="bg-blue-600 text-white hover:bg-blue-700 px-8 py-4 rounded-full font-semibold text-lg shadow-xl transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Masuk
                        </button>
                    </div>
                </form>

                <!-- Signup Form (Hidden by default) -->
                <form id="signup-form" class="space-y-6 hidden">
                    <div>
                        <label for="signup-display-name" class="block text-lg font-medium text-gray-700 mb-2">Nama Tampilan</label>
                        <input type="text" id="signup-display-name" name="signup-display-name" placeholder="Nama yang akan ditampilkan" required
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-gray-800">
                    </div>
                    <div>
                        <label for="signup-email" class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="signup-email" name="signup-email" placeholder="Masukkan email Anda" required
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-gray-800">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-lg font-medium text-gray-700 mb-2">Kata Sandi</label>
                        <input type="password" id="signup-password" name="signup-password" placeholder="Buat kata sandi (min. 6 karakter)" required
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-gray-800">
                    </div>
                    <div class="text-center">
                        <button type="submit" id="signup-button" class="bg-blue-600 text-white hover:bg-blue-700 px-8 py-4 rounded-full font-semibold text-lg shadow-xl transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Daftar
                        </button>
                    </div>
                </form>
            </div>
        </main>

        <!-- Footer Section (Consistent with other pages) -->
        <footer class="bg-gray-800 text-white py-8">
            <div class="container mx-auto px-4 text-center">
                <p class="text-gray-400">&copy; 2025 Piilancer. All rights reserved.</p>
                <div class="flex justify-center space-x-6 mt-4">
                    <a href="https://instagram.com/piilancer" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition duration-300 rounded-lg p-2 hover:bg-gray-700 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M12.315 2.411a.75.75 0 01.597.953l-1.39 4.364 7.26 2.253a.75.75 0 01.385 1.487l-7.26 2.253 1.39 4.364a.75.75 0 01-1.35.43l-1.39-4.364-7.26 2.253a.75.75 0 01-.385-1.487l7.26-2.253-1.39-4.364a.75.75 0 01.75-.43zM12 0a12 12 0 100 24 12 12 0 000-24z" clip-rule="evenodd" />
                        </svg>
                        <span>@piilancer</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300 rounded-lg p-2 hover:bg-gray-700">Kebijakan Privasi</a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300 rounded-lg p-2 hover:bg-gray-700">Ketentuan Layanan</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK CDN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Firebase configuration (provided by Canvas environment)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // Get elements
        const messageArea = document.getElementById('message-area');
        const firebaseStatusDiv = document.getElementById('firebase-status'); // New element
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');

        // Get header profile menu elements
        const profileMenuButton = document.getElementById('profile-menu-button');
        const profileMenu = document.getElementById('profile-menu');
        const profilePic = document.getElementById('profile-pic');
        const profileIcon = document.getElementById('profile-icon');
        const loginSignupLinkHeader = document.getElementById('login-signup-link');
        const myProfileLink = document.getElementById('my-profile-link');
        const logoutButton = document.getElementById('logout-button');

        let app;
        let auth;

        // Custom message display function (replaces alert)
        function displayCustomMessage(message, type = 'success') {
            console.log(`UI Message (${type}): ${message}`); // Log to console
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Initialize Firebase on window load
        window.onload = () => {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    firebaseStatusDiv.textContent = 'Firebase berhasil diinisialisasi.';
                    firebaseStatusDiv.classList.remove('hidden');
                    firebaseStatusDiv.classList.remove('bg-red-50', 'text-red-800', 'border-red-200');
                    firebaseStatusDiv.classList.add('bg-blue-50', 'text-blue-800', 'border-blue-200');
                    console.log("Firebase app initialized:", app);
                    console.log("Firebase auth object:", auth);
                } else {
                    firebaseStatusDiv.textContent = 'Firebase config tidak ditemukan. Pastikan __firebase_config disediakan.';
                    firebaseStatusDiv.classList.remove('hidden');
                    firebaseStatusDiv.classList.remove('bg-blue-50', 'text-blue-800', 'border-blue-200');
                    firebaseStatusDiv.classList.add('bg-red-50', 'text-red-800', 'border-red-200');
                    console.error("Firebase config is empty or missing.");
                }
            } catch (error) {
                firebaseStatusDiv.textContent = `Error inisialisasi Firebase: ${error.message}`;
                firebaseStatusDiv.classList.remove('hidden');
                firebaseStatusDiv.classList.remove('bg-blue-50', 'text-blue-800', 'border-blue-200');
                firebaseStatusDiv.classList.add('bg-red-50', 'text-red-800', 'border-red-200');
                console.error("Error initializing Firebase:", error);
                displayCustomMessage(`Error inisialisasi Firebase: ${error.message}`, 'error');
            }
        };

        // Toggle profile menu visibility
        profileMenuButton.addEventListener('click', (event) => {
            event.stopPropagation(); // Prevent click from bubbling to window
            profileMenu.classList.toggle('hidden');
        });

        // Close menu if clicked outside
        window.addEventListener('click', (event) => {
            if (!profileMenuButton.contains(event.target) && !profileMenu.contains(event.target)) {
                profileMenu.classList.add('hidden');
            }
        });

        // Handle logout
        logoutButton.addEventListener('click', async () => {
            if (!auth) {
                displayCustomMessage('Firebase Auth belum diinisialisasi.', 'error');
                console.error('Logout failed: Firebase Auth not initialized.');
                return;
            }
            try {
                await signOut(auth);
                console.log("User logged out successfully.");
                displayCustomMessage('Logout berhasil!', 'success');
                window.location.href = 'homepage-template.html'; // Redirect to homepage after logout
            } catch (error) {
                console.error("Logout Error:", error);
                displayCustomMessage('Terjadi kesalahan saat logout. Coba lagi.', 'error');
            }
        });

        // Listen for authentication state changes (for header profile menu)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Auth State Changed: User is logged in.", user.uid);
                profileIcon.classList.add('hidden');
                profilePic.classList.remove('hidden');
                if (user.photoURL) {
                    profilePic.src = user.photoURL;
                } else {
                    const initial = user.displayName ? user.displayName.charAt(0).toUpperCase() : (user.email ? user.email.charAt(0).toUpperCase() : 'U');
                    profilePic.src = `https://placehold.co/40x40/cbd5e1/4a5568?text=${initial}`;
                }
                loginSignupLinkHeader.classList.add('hidden');
                myProfileLink.classList.remove('hidden');
                logoutButton.classList.remove('hidden');
            } else {
                console.log("Auth State Changed: User is logged out.");
                profileIcon.classList.remove('hidden');
                profilePic.classList.add('hidden');
                loginSignupLinkHeader.classList.remove('hidden');
                myProfileLink.classList.add('hidden');
                logoutButton.classList.add('hidden');
            }
        });

        // Tab switching logic
        loginTab.addEventListener('click', () => {
            loginTab.style.backgroundColor = '#3b82f6';
            loginTab.style.color = 'white';
            signupTab.style.backgroundColor = '#e0f2fe';
            signupTab.style.color = '#3b82f6';
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            messageArea.innerHTML = ''; // Clear messages on tab switch
            console.log("Switched to Login tab.");
        });

        signupTab.addEventListener('click', () => {
            signupTab.style.backgroundColor = '#3b82f6';
            signupTab.style.color = 'white';
            loginTab.style.backgroundColor = '#e0f2fe';
            loginTab.style.color = '#3b82f6';
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            messageArea.innerHTML = ''; // Clear messages on tab switch
            console.log("Switched to Signup tab.");
        });

        // Handle Login Form Submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!auth) {
                displayCustomMessage('Firebase Auth belum diinisialisasi.', 'error');
                console.error('Login attempt failed: Firebase Auth not initialized.');
                return;
            }
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            console.log(`Attempting login for email: ${email}`);

            try {
                await signInWithEmailAndPassword(auth, email, password);
                displayCustomMessage('Login berhasil! Anda akan dialihkan.', 'success');
                console.log("Login successful. Redirecting to tulis-blog-page.html");
                // Redirect to Tulis Blog page after successful login
                window.location.href = 'tulis-blog-page.html';
            } catch (error) {
                console.error("Login Error:", error.code, error.message);
                let errorMessage = 'Terjadi kesalahan saat login. Periksa email dan kata sandi Anda.';
                if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Format email tidak valid.';
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = 'Email atau kata sandi salah.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Terlalu banyak percobaan login. Coba lagi nanti.';
                }
                displayCustomMessage(errorMessage, 'error');
            }
        });

        // Handle Signup Form Submission
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!auth) {
                displayCustomMessage('Firebase Auth belum diinisialisasi.', 'error');
                console.error('Signup attempt failed: Firebase Auth not initialized.');
                return;
            }
            const displayName = document.getElementById('signup-display-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            console.log(`Attempting signup for email: ${email}, display name: ${displayName}`);

            if (password.length < 6) {
                displayCustomMessage('Kata sandi harus minimal 6 karakter.', 'error');
                console.warn('Signup validation failed: Password too short.');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: displayName });
                displayCustomMessage('Pendaftaran berhasil! Anda akan dialihkan.', 'success');
                console.log("Signup successful. Redirecting to tulis-blog-page.html");
                // Redirect to Tulis Blog page after successful signup
                window.location.href = 'tulis-blog-page.html';
            } catch (error) {
                console.error("Signup Error:", error.code, error.message);
                let errorMessage = 'Terjadi kesalahan saat mendaftar.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email ini sudah terdaftar.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Format email tidak valid.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Kata sandi terlalu lemah. Gunakan kombinasi yang lebih kuat.';
                }
                displayCustomMessage(errorMessage, 'error');
            }
        });
    </script>
</body>
</html>
